@model IEnumerable<OnDemandService.Models.CategoryViewModel>
@{
    ViewBag.Title = "ViewCategories";
    Layout = "~/Areas/Professional/Views/Shared/_Layout.cshtml";
    WebGrid webGrid = new WebGrid(source: Model, canSort: false);
}

<h2>View Categories</h2>

<div id="mainT" style="padding: 25px; background-color: white;">
    @webGrid.GetHtml(
        htmlAttributes: new { @id = "WebGrid", @class = "Grid" },
        columns: webGrid.Columns(
                 webGrid.Column(null, null, format: @<text><img src="~/Areas/Admin/images/plus.png" /><div style="display:none"></div></text>),
                    webGrid.Column("Category.CategoryId", "Category Id"),
                    webGrid.Column("Category.CategoryName", "Category Name"),
                    webGrid.Column(format: (item) =>
                    {
                    WebGrid childGrid = new WebGrid(source: item.subCategories, canSort: false, canPage: false);
                        return childGrid.GetHtml(
                            htmlAttributes: new { @class = "ChildGrid" },
                            columns: childGrid.Columns(
                            
                            childGrid.Column("SubCategoryName", "Subcategory Name"),
                            childGrid.Column("Price", "Price"),
                            @*childGrid.Column("SubCategoryId", "Edit", 
                            format: @<text> @Html.ActionLink(linkText: "Edit", actionName: "Edit", routeValues: new { id = "SubCategoryId" })</text>)*@
                            childGrid.Column(columnName: "Edit", format: (items) => Html.ActionLink(("Edit"), "EditSubCategory",  new { id = items.SubCategoryId })),
                            childGrid.Column(columnName: "Delete", format: (items) => Html.ActionLink(("Delete"), "DeleteSubCategory",  new { id = items.SubCategoryId }))
                            
                        
                        ));
                    })
                ))
</div>


@section styles{
    <style type="text/css">
        body { font-family: Arial; font-size: 10pt; }
        .Grid { border: 1px solid #ccc; border-collapse: collapse; background-color: #fff; }
        .Grid th { background-color: #B8DBFD; color: #333; font-weight: bold; }
        .Grid th, .Grid td { padding: 5px; border: 1px solid #ccc; }
        .Grid img { cursor:pointer; }
        .ChildGrid { width: 100%; }
        .ChildGrid th { background-color: #6C6C6C; color: #fff; font-weight: bold; }
        
    </style>
}

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            //var size = $("#main #gridT > thead > tr > th").length;   //get total column
            
            //$("#main #gridT > thead > tr > th").last().remove();  //remove last column
            //$("#main #gridT > thead > tr").prepend("<th></th>");  //add one column at first for collapsable column
            //$("#main #gridT > thead > tr").each(function (i, el) {
            //    $(this).prepend(
            //        $("<td></td>")
            //            .addClass("expand")
            //            .addClass("hoverEff")
            //            .attr('title', "Click to Show/Hide")
            //    );

            //    //Now get subtable from last column and add this to the next new added row
            //    var table = $("table", this).parent().html;
            //    //add new row with this subtable 
            //    $(this).after("<tr><td style='padding: 5px; margin: 0px; colspan='" + (size - 1) + "''>" + table + "</td></tr>");
            //    $("table", this).parent().remove();

            //    //Add click event for making collapsible
            //    $(".hoverEff").on('click', this , function () {
            //        $(this).parent().closest("tr").next().slideToggle(1000);
            //        $(this).toggleClass("expand collapse");
            //    });
            //});

            ////by default make all subgrid in collapse mode
            //$("#main #gridT > thead > tr td.expand").each(function (i, el) {
            //    $(this).toggleClass("expand collapse");
            //    $(this).parent().closest("tr").next().slideToggle(1000);
            //});

            var imageFolder = '../../images/';
            $(function () {
            //Loop through all Child Grids.
            $("#WebGrid .ChildGrid").each(function () {
                //Copy the Child Grid to DIV.
                var childGrid = $(this).clone();
                $(this).closest("TR").find("TD").eq(0).find("DIV").append(childGrid);
 
                //Remove the Last Column from the Row.
                $(this).parent().remove();
            });
 
            //Remove Last Column from Header Row.
            $("#WebGrid TH:last-child").eq(0).remove();
            });
            //Assign Click event to Plus Image.
            $("body").on("click", "img[src*='plus.png']", function () {
                $(this).closest("tr").after("<tr><td></td><td colspan = '999'>" + $(this).next().html() + "</td></tr>");
                //$(this).attr("src", "~/Areas/Admin/images/minus.png");
                var imageName = "minus.png";
                $(this).attr("src", imageFolder + imageName);
            });
            //Assign Click event to Minus Image.
            $("body").on("click", "img[src*='minus.png']", function () {
                var imageName = "plus.png";
                $(this).attr("src", imageFolder + imageName);
                $(this).closest("tr").next().remove();
            });




        });

    </script>
    

}
